<!-- views/administracion/crear.ejs -->
<%- include('../partials/header', { title: 'Crear ' + tabla }) %>
<%- include('../partials/navbar') %>
<%- include('../partials/sidebar') %>
<%- include('../partials/content-wrapper-open') %>

<div class="container-xxl flex-grow-1 container-p-y">
  <h4 class="mb-4">Crear Registro en <%= tabla.charAt(0).toUpperCase() + tabla.slice(1) %></h4>
  <div class="card">
    <div class="card-body">
      <% if (typeof errores !== 'undefined' && errores.length > 0) { %>
        <div class="alert alert-danger">
          <ul>
            <% errores.forEach(error => { %>
              <li><%= error.msg %></li>
            <% }) %>
          </ul>
        </div>
      <% } %>
      <form action="/administracion/<%= tabla %>/crear" method="POST" novalidate>
        <% columnas.forEach(columna => { %>
          <% if (columna.inputType !== 'hidden') { %>
            <div class="mb-3">
              <label for="<%= columna.nombre %>" class="form-label">
                <%= columna.nombre.charAt(0).toUpperCase() + columna.nombre.slice(1) %><%= columna.editable ? ' *' : '' %>
              </label>
              <% if (columna.inputType === 'select') { %>
                <% if (tabla === 'ProveedorBanco') { %>
                  <% if (columna.nombre === 'ID_PROVEEDOR') { %>
                    <select class="form-select" id="<%= columna.nombre %>" name="<%= columna.nombre %>" <%= columna.editable ? 'required' : 'disabled' %>>
                      <option value="">Seleccione un Proveedor</option>
                      <% proveedores.forEach(proveedor => { %>
                        <option value="<%= proveedor.ID_PROVEEDOR %>"><%= proveedor.NOMBRE_PROVEEDOR %></option>
                      <% }) %>
                    </select>
                  <% } else if (columna.nombre === 'ID_BANCO') { %>
                    <select class="form-select" id="<%= columna.nombre %>" name="<%= columna.nombre %>" <%= columna.editable ? 'required' : 'disabled' %>>
                      <option value="">Seleccione un Banco</option>
                      <% bancos.forEach(banco => { %>
                        <option value="<%= banco.ID_BANCO %>"><%= banco.NOMBRE_BANCO %></option>
                      <% }) %>
                    </select>
                  <% } %>
                <% } else if (tabla === 'DetalleTipoOrden' && columna.nombre === 'ID_TIPO_ORDEN') { %>
                  <select class="form-select" id="<%= columna.nombre %>" name="<%= columna.nombre %>" <%= columna.editable ? 'required' : 'disabled' %>>
                    <option value="">Seleccione un Tipo de Orden</option>
                    <% tiposOrden.forEach(tipo => { %>
                      <option value="<%= tipo.ID_TIPO %>"><%= tipo.NOMBRE %></option>
                    <% }) %>
                  </select>
                <% } else { %>
                  <!-- Opciones para otras tablas si es necesario -->
                <% } %>
              <% } else { %>
                <input 
                  type="<%= columna.inputType %>" 
                  class="form-control" 
                  id="<%= columna.nombre %>" 
                  name="<%= columna.nombre %>" 
                  value="" 
                  <%= columna.editable ? 'required' : 'readonly' %>
                >
              <% } %>
            </div>
          <% } else { %>
            <!-- Campos ocultos para columnas como IDs -->
            <input 
              type="hidden" 
              id="<%= columna.nombre %>" 
              name="<%= columna.nombre %>" 
              value=""
            >
          <% } %>
        <% }) %>
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a href="/administracion/<%= tabla %>" class="btn btn-secondary">Cancelar</a>
      </form>
    </div>
  </div>
</div>

<%- include('../partials/footer-text') %>
<%- include('../partials/footer') %>
<%- include('../partials/content-wrapper-close') %>

<script>
  (function () {
    'use strict'
    const forms = document.querySelectorAll('form')

    Array.from(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
          form.classList.add('was-validated')
        }
      }, false)
    })
  })()
</script>

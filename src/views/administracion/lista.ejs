<%- include('../partials/header', { title: 'Administración - ' + tabla }) %>
<%- include('../partials/navbar') %>
<%- include('../partials/sidebar') %>
<%- include('../partials/content-wrapper-open') %>
<style>
  .table td {
    vertical-align: middle;
  }
  .id-column {
    width: 50px;
    max-width: 50px;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
  }
  .descripcion-column {
    max-width: 300px;
    word-wrap: break-word;
    white-space: normal;
  }
  .btn-group .btn {
    margin-right: 5px;
  }
  .action-buttons .btn {
    margin-right: 10px;
  }
</style>

<div class="container-xxl flex-grow-1 container-p-y">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
    <div>
      <h4 class="mb-1">Lista de <%= tabla %></h4>
      <p class="mb-0">Gestión de registros en la tabla <%= tabla %>.</p>
    </div>
    <div class="d-flex action-buttons">
      <a href="/administracion" class="btn btn-secondary me-2">
        <i class="fas fa-arrow-left me-1"></i> Regresar
      </a>
      <a href="/administracion/<%= tabla %>/crear" class="btn btn-primary">
        <i class="fas fa-plus me-1"></i> Crear Nuevo
      </a>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table id="tabla-registros" class="table table-hover w-100">
          <thead>
            <tr>
              <% if (registros.length > 0) { %>
                <% Object.keys(registros[0]).forEach(columna => { %>
                  <th><%= columna %></th>
                <% }) %>
                <th>Acciones</th>
              <% } else { %>
                <th>No hay registros</th>
              <% } %>
            </tr>
          </thead>
          <tbody>
            <% registros.forEach(registro => { %>
              <tr>
                <% Object.keys(registro).forEach(columna => { %>
                  <% if (columna.toLowerCase() === 'id' || columna.toLowerCase() === 'id_' + tabla.toLowerCase()) { %>
                    <td class="id-column"><%= registro[columna] %></td>
                  <% } else if (columna.toLowerCase().includes('descripcion') || columna.toLowerCase().includes('detalle')) { %>
                    <td class="descripcion-column"><%= registro[columna] %></td>
                  <% } else { %>
                    <td><%= registro[columna] %></td>
                  <% } %>
                <% }) %>
                <td>
                  <div class="btn-group" role="group">
                    <a href="/administracion/<%= tabla %>/editar/<%= registro.Id %>" class="btn btn-sm btn-outline-secondary" title="Editar">
                      <i class="fas fa-edit"></i>
                    </a>
                    <form action="/administracion/<%= tabla %>/eliminar/<%= registro.Id %>" method="POST" style="display:inline-block;">
                      <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar">
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer-text') %>
<%- include('../partials/footer') %>
<%- include('../partials/content-wrapper-close') %>

<script>
  $(document).ready(function() {
    $('#tabla-registros').DataTable({
      responsive: true,
      autoWidth: false,
      language: {
        url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",
        search: "",
        emptyTable: "No hay registros disponibles."
      },
      pageLength: 10,
      lengthChange: false,
      order: [],
      columnDefs: [
        {
          targets: -1,
          orderable: false,
          searchable: false,
          responsivePriority: 1
        },
        {
          targets: 0,
          responsivePriority: 2
        },
        {
          targets: '_all',
          responsivePriority: 3
        }
      ],
      initComplete: function () {
        var dataTableFilter = $('#tabla-registros_filter');
        var searchInput = dataTableFilter.find('input').detach();
        dataTableFilter.empty();

        var searchInputGroup = $('<div class="input-group"></div>');
        var searchIcon = $('<span class="input-group-text"><i class="fas fa-search"></i></span>');
        searchInput.addClass('form-control').attr('placeholder', 'Buscar...');
        searchInputGroup.append(searchIcon).append(searchInput);

        dataTableFilter.append(searchInputGroup);
        dataTableFilter.css('float', 'left');
      }
    });
  });
</script>
